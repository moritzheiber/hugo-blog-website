<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Dynamics DNS with pfSense and Route53 | Moritz Heiber</title>
<meta name=description content="Hi, I'm Moritz. My purpose in life seems to be trying to outsmart computers. I'm really bad at it most of the time. These are the artifacts I've collected along the way.">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Dynamics DNS with pfSense and Route53">
<meta property="og:description" content="The quite excellent pfSense comes with a dynamic DNS plugin for Amazon&rsquo;s Route53 DNS management service. However, there is little to no documentation provided on how to set it up properly and especially about setting up the relevant IAM access policies.
So I went to the pfSense repository on GitHub and browsed the code in order to find out how much access the plugin needed in order to do its deed.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heiber.im/posts/dynamics-dns-with-pfsense-and-route53/">
<meta property="article:published_time" content="2014-02-28T12:17:36+01:00">
<meta property="article:modified_time" content="2020-12-25T20:24:33+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Dynamics DNS with pfSense and Route53">
<meta name=twitter:description content="The quite excellent pfSense comes with a dynamic DNS plugin for Amazon&rsquo;s Route53 DNS management service. However, there is little to no documentation provided on how to set it up properly and especially about setting up the relevant IAM access policies.
So I went to the pfSense repository on GitHub and browsed the code in order to find out how much access the plugin needed in order to do its deed.">
<link rel=stylesheet href=https://heiber.im/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://heiber.im/images/favicon.ico>
<link rel=apple-touch-icon sizes=180x180 href=https://heiber.im/images/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://heiber.im/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://heiber.im/images/favicon-32x32.png>
<link rel=manifest href=https://heiber.im/site.webmanifest>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=https://heiber.im/>home</a></li>
<li><a href=https://heiber.im/about>about</a></li>
<li><a href=https://heiber.im/posts>blog</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://heiber.im/about/>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
</a>
</li>
<li>
<a class=icon href=#>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f">
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&text=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&is_video=false&description=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Dynamics%20DNS%20with%20pfSense%20and%20Route53&body=Check out this article: https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f">
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-stumbleupon" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://digg.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-digg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&name=Dynamics%20DNS%20with%20pfSense%20and%20Route53&description=The%20quite%20excellent%20pfSense%20comes%20with%20a%20dynamic%20DNS%20plugin%20for%20Amazon%26rsquo%3bs%20Route53%20DNS%20management%20service.%20However%2c%20there%20is%20little%20to%20no%20documentation%20provided%20on%20how%20to%20set%20it%20up%20properly%20and%20especially%20about%20setting%20up%20the%20relevant%20IAM%20access%20policies.%0aSo%20I%20went%20to%20the%20pfSense%20repository%20on%20GitHub%20and%20browsed%20the%20code%20in%20order%20to%20find%20out%20how%20much%20access%20the%20plugin%20needed%20in%20order%20to%20do%20its%20deed.">
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&t=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents></nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Dynamics DNS with pfSense and Route53
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2014-02-28 12:17:36 +0100 +0100" itemprop=datePublished>2014-02-28</time>
(Updated: <time datetime="2020-12-25 20:24:33 +0100 +0100" itemprop=dateModified>2020-12-25</time>)
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=https://heiber.im/categories/pfsense>pfsense</a>
,
<a class=category-link href=https://heiber.im/categories/aws>aws</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=https://heiber.im/tags/aws rel=tag>aws</a>
,
<a class=tag-link href=https://heiber.im/tags/dns rel=tag>dns</a>
,
<a class=tag-link href=https://heiber.im/tags/route53 rel=tag>route53</a>
,
<a class=tag-link href=https://heiber.im/tags/pfsense rel=tag>pfsense</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>The quite excellent <a href=https://pfsense.org>pfSense</a> comes with a <a href=http://en.wikipedia.org/wiki/Dynamic_DNS>dynamic DNS</a> plugin for <a href=http://aws.amazon.com/route53/>Amazon&rsquo;s Route53 DNS management service</a>. However, there is little to no documentation provided on how to set it up properly and especially about setting up the <a href=http://aws.amazon.com/iam/>relevant IAM access policies</a>.</p>
<p>So I went to the <a href=https://github.com/pfsense/>pfSense repository on GitHub</a> and browsed the code in order to find out how much access the plugin needed in order to do its deed.</p>
<p>As it turns out: not much. The following IAM policy will grant the plugin the required permissions to access Route53 on your behalf:</p>
<pre><code>{
  &quot;Statement&quot;:[
    {
      &quot;Effect&quot;:&quot;Allow&quot;,
      &quot;Action&quot;:[
        &quot;route53:ChangeResourceRecordSets&quot;,
        &quot;route53:ListResourceRecordSets&quot;
      ],
     &quot;Resource&quot;:&quot;arn:aws:route53:::hostedzone/&lt;your-hosted-zone-id&gt;&quot;
    }
  ]
}
</code></pre>
<p>Notice the <code>&lt;your-hosted-zone-id></code> which you need to exchange for the ID your zone has been assigned to within Route53.</p>
<p>What the dynamics DNS module within pfSense actually does:</p>
<ol>
<li>Connect to the AWS API and look up all the records within the zone you configured</li>
<li>Determines whether there is a record by the name you entered</li>
</ol>
<ul>
<li>If there is it deletes the record and adds it back with the new IP address attached to it.
<ul>
<li><em>Note: This is also why it is very wise to chose a very low (&lt;= 60 seconds) TTL for your dynamic DNS record</em></li>
</ul>
</li>
<li>If there isn&rsquo;t it creates a new record and attaches the IP address to it</li>
</ul>
<ol start=3>
<li>Saves the IP address it just set within Route53 to a file within the pfSense environment to make sure it doesn&rsquo;t update the same record twice</li>
</ol>
<ul>
<li>The IP either gets updated when the locally recorded IP address doesn&rsquo;t match the record on Route53 or every 25 days</li>
</ul>
<p>After that the A record should get updated automatically each time the IP changes on the associated interface.</p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=https://heiber.im/>home</a></li>
<li><a href=https://heiber.im/about>about</a></li>
<li><a href=https://heiber.im/posts>blog</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents></nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f">
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&text=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&is_video=false&description=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Dynamics%20DNS%20with%20pfSense%20and%20Route53&body=Check out this article: https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f">
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://digg.com/submit?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&title=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-digg fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&name=Dynamics%20DNS%20with%20pfSense%20and%20Route53&description=The%20quite%20excellent%20pfSense%20comes%20with%20a%20dynamic%20DNS%20plugin%20for%20Amazon%26rsquo%3bs%20Route53%20DNS%20management%20service.%20However%2c%20there%20is%20little%20to%20no%20documentation%20provided%20on%20how%20to%20set%20it%20up%20properly%20and%20especially%20about%20setting%20up%20the%20relevant%20IAM%20access%20policies.%0aSo%20I%20went%20to%20the%20pfSense%20repository%20on%20GitHub%20and%20browsed%20the%20code%20in%20order%20to%20find%20out%20how%20much%20access%20the%20plugin%20needed%20in%20order%20to%20do%20its%20deed.">
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fheiber.im%2fposts%2fdynamics-dns-with-pfsense-and-route53%2f&t=Dynamics%20DNS%20with%20pfSense%20and%20Route53">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;">
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;">
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;">
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2020 Licensed under CC-by-4.0
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=https://heiber.im/>home</a></li>
<li><a href=https://heiber.im/about>about</a></li>
<li><a href=https://heiber.im/posts>blog</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=https://heiber.im/lib/font-awesome/css/all.min.css>
<script src=https://heiber.im/lib/jquery/jquery.min.js></script>
<script src=https://heiber.im/js/main.js></script>
</html>